"use strict";angular.module("webappApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","smart-table","ui.autocomplete","ui.bootstrap","angular-timeline","angular-scroll-animate"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainController"}).when("/about",{templateUrl:"views/about.html"}).when("/training-home",{templateUrl:"views/training-home.html",controller:"TrainingHomeController"}).when("/user-center/:alias",{templateUrl:"views/user-center.html",controller:"UserCenterController"}).when("/user-center-plaza",{templateUrl:"views/user-center-plaza.html",controller:"UserCenterPlazaController"}).when("/training-course/:courseId",{templateUrl:"views/training-course.html",controller:"TrainingCourseController"}).when("/create-training-course",{templateUrl:"views/create-training-course.html",controller:"CreateTrainingCourseController"}).otherwise({redirectTo:"/"})}]),angular.module("webappApp").controller("MainController",["$scope","$http","$window",function(a,b,c){var d=function(){return b.get("/api/current-user")};d().then(function(b){a.currentUser=b.data}),a.signOff=function(){b.post("/api/logoff").then(function(){a.currentUser=null,c.location.href="/training"})}}]),angular.module("webappApp").controller("TrainingCourseController",["$compile","$rootScope","$scope","$routeParams","$window","TrainingCourseService","FeedbackService","CourseAttachmentService","UserService",function(a,b,c,d,e,f,g,h,i){c.isAdmin=!1,c.noAttachment=!0,c.range=function(a){return new Array(a)},f.getTrainingCourse(d.courseId).then(function(a){c.course=a.data,c.noAttachment=!c.course.Attachment}),f.getKeySkills(d.courseId).then(function(a){c.keySkills=a.data}),i.getCurrentUser().then(function(a){c.feedback.anonymous=!1,c.isAdmin="admin"===a.data.Role},function(){c.feedback.anonymous=!0}),c.$on("clickRating",function(a,b){c.feedback.score=b.rating}),c.downloadCourseAttachment=function(){h.downloadAttachment(d.courseId,c.appPath)},c.uploadCourseAttachments=function(){var a=angular.element("#course-attachments").get(0).files;if(!(a.length<1)){var b=new FormData;b.append("CourseAttachments",a[0]),h.uploadAttachment(d.courseId,b).done(function(a,b){c.noAttachment=!1})}};var j=function(){f.getFeedbacks(d.courseId).then(function(a){c.feedbackItems=a.data;var b=g.getRatingDistribute(a.data);c.feedbackStats={scoresCatalag:[{score:10,percentage:b[10]},{score:8,percentage:b[8]},{score:6,percentage:b[6]},{score:4,percentage:b[4]},{score:2,percentage:b[2]}],averageScore:g.getAverageRating(a.data)}})},k=function(){c.feedbackStats={scoresCatalag:[{score:10,percentage:"0%"},{score:8,percentage:"0%"},{score:6,percentage:"0%"},{score:4,percentage:"0%"},{score:2,percentage:"0%"}],averageScore:0}},l=function(){c.feedback={score:0,comments:""},b.$broadcast("clearFeedbackScore")};l(),k(),j(),c.goToUserCenter=function(a){e.location.href="#user-center/"+a},c.submitFeedback=function(){var a={rating:c.feedback.score,comments:c.feedback.comments,courseGuid:d.courseId};f.postFeedback(c.feedback.anonymous||!1,a).then(function(){l(),j()})},c.registerRoster=function(){f.register(c.modelObj.GIN,d.courseId).then(function(a){c.rosters=a.data,c.modelObj.label="",c.modelObj.value=""})},c.deleteRoster=function(a){f.deleteRoster(a,d.courseId).then(function(a){c.rosters=a.data})},c.resetFeedback=function(){l()},f.getRoster(d.courseId).then(function(a){c.rosters=a.data});var m;f.getUserinfos().then(function(a){m=a.data}),c.modelObj={label:"",value:"",GIN:""},c.myOption={options:{html:!0,focusOpen:!1,onlySelectValid:!0,appendTo:".roster-selector",source:function(a,b){var d=[];_.each(m,function(a,b){d.push({label:a.UserInfo,value:a.UserInfo,GIN:a.GIN})});var e=c.myOption.methods.filter(d,a.term);e.length||e.push({label:"not found",value:""}),b(e)}}}}]),angular.module("webappApp").controller("CreateTrainingCourseController",["$rootScope","$scope","TrainingCourseService","SkillService",function(a,b,c,d){b.course={Title:"",StartDate:"",EndDate:"",Location:"",Instructor:"",InstructorIntroduction:"",MaximumEnroll:"",Language:"English",KeySkills:[],Cost:"",CourseIntroduction:"",Curriculum:""},b.keySkillPool=[],b.keySkillModel={label:"",value:"",keySkill:""};var e=[];d.getSkills().then(function(a){e=a.data}),b.addKeySkills=function(){b.keySkillModel.label&&b.keySkillModel.value&&(b.keySkillPool.push(b.keySkillModel.keySkill),b.keySkillModel.label="",b.keySkillModel.value="")},b.deleteKeySkill=function(a){var c=_.indexOf(b.keySkillPool,a);-1!==c&&b.keySkillPool.splice(c,1)},b.myOption={options:{html:!0,focusOpen:!0,onlySelectValid:!0,appendTo:".key-skills",source:function(a,c){var d=[];_.each(e,function(a,b){d.push({label:a.Element,value:a.Element,keySkill:{Guid:a.KeyGUID,Element:a.Element}})});var f=b.myOption.methods.filter(d,a.term);f.length||f.push({label:"not found",value:""}),c(f)}}},b.createTrainingCourse=function(){b.course.KeySkills=_.pluck(b.keySkillPool,"Guid"),c.postTrainingCourse(b.course).then(function(){alert("create successfully"),b.course.KeySkills=[]})}}]),angular.module("webappApp").controller("TrainingHomeController",["$scope","$rootScope","$window","$http","$filter","TrainingCourseService","UserService",function(a,b,c,d,e,f,g){g.getCurrentUser().then(function(b){"admin"===b.data.Role?a.isAdmin=!0:a.isAdmin=!1}),a.searchKeyWords="",a.getTrainingCourses=function(){f.getTrainingCourses().then(function(b){a.trainingCourses=b.data,a.totalTrainingCoursesCount=b.data.length,a.coursesSummary="all",a.order("StartDate",!0)},function(){console.log("load training courses failed")})},a.getTrainingCourses(),f.getSkillCourseRelations().then(function(b){a.skills=b.data}),a.order=function(b,c){a.trainingCourses=e("orderBy")(a.trainingCourses,b,c)},a.goToCreateTrainingCourse=function(){c.location.href="#/create-training-course"},a.goToTrainingCourse=function(a){c.location.href="#/training-course/"+a},a.searchCourseBySkill=function(b,c){f.getTrainingCoursesBySkill(b).then(function(b){a.trainingCourses=b.data,a.coursesSummary=c})},a.searchTrainingCourses=function(){var b,c;a.searchKeyWords?(c=a.searchKeyWords,b=f.searchTrainingCourses(a.searchKeyWords.replace(/\s+/g,","))):(b=f.getTrainingCourses(),c="all"),b.then(function(b){a.trainingCourses=b.data,a.coursesSummary=c,a.order("Title",!1)},function(){console.log("failed")})}}]),angular.module("webappApp").controller("UserHistoryTrainingCourseController",["$scope","$routeParams","$window","UserService","UserKpiService",function(a,b,c,d,e){d.getUserHistoryTrainingCourse(b.alias).then(function(b){a.trainingCourses=b.data;var c=e.getTrainingDays(a.trainingCourses);a.$emit("trainingSummary",{trainingDays:c,trainingTimes:a.trainingCourses?a.trainingCourses.length:0})}),a.goToTrainingCourse=function(a){c.location.href="#/training-course/"+a}}]),angular.module("webappApp").controller("UserCenterController",["$scope","$routeParams","$window","UserService",function(a,b,c,d){d.getUser(b.alias).then(function(b){a.user=b.data}),a.$on("trainingSummary",function(b,c){a.trainingDays=c.trainingDays,a.trainingTimes=c.trainingTimes})}]),angular.module("webappApp").controller("UserCenterPlazaController",["$scope","$routeParams","$window","UserService",function(a,b,c,d){d.getExperts().then(function(b){a.experts=b.data}),a.goToUserCenter=function(a){c.location.href="#user-center/"+a}}]),angular.module("webappApp").controller("SkillMapHomeController",["$scope","$http",function(a,b){b.get("/api/projects?Scope=ProductLine").then(function(a){console.log(a)}),a.productlines=[{name:"Drilling",id:"54455e14-6323-4879-8823-8a1a1a8febfc"},{name:"IA",id:"086166b5-bfb7-4939-a2af-745f2ab3525c"},{name:"IE",id:"cc0d9002-e781-4045-8525-b109db00237d"},{name:"IT",id:"f7a999ac-375e-415e-9ff3-4e60cdb0e738"},{name:"Maxwell",id:"2b323beb-123e-4792-9d4c-b0573fc096cf"},{name:"Maxwell Apps",id:"2262898b-e2e5-47da-ad05-bd36c239c74b"},{name:"MÃ©tier",id:"b209ad1b-ce32-4fd0-a8dd-2ff48b64bb02"},{name:"QA",id:"5da2ddde-f01d-45fe-8683-1294fcf7cc70"}]}]),angular.module("webappApp").service("TrainingCourseService",["$http",function(a){return{getTrainingCourses:function(){return a.get("/api/training-courses")},searchTrainingCourses:function(b){return a.get("/api/search-training-courses/"+b)},getTrainingCourse:function(b){return a.get("/api/training-courses/"+b)},getKeySkills:function(b){return a.get("/api/training-courses/"+b+"/key-skills")},postFeedback:function(b,c){return a.post("/api/training-course/rating/"+b,{Rating:c.rating,Comments:c.comments,CourseGuid:c.courseGuid})},getRoster:function(b){return a.get("/api/training-courses/"+b+"/roster")},getFeedbacks:function(b){return a.get("/api/training-courses/"+b+"/rating")},register:function(b,c){return a.post("/api/training-courses/register",{CourseGuid:c,UserGin:b})},deleteRoster:function(b,c){return a.post("/api/training-courses/"+c+"/roster/"+b)},postTrainingCourse:function(b){return a.post("/api/create-training-course",b)},getSkillCourseRelations:function(){return a.get("/api/get-training-course-relations")},getTrainingCoursesBySkill:function(b){return a.get("/api/training-courses-by-skill/"+b)},getUserinfos:function(){return a.get("/api/userinfos")}}}]),angular.module("webappApp").service("FeedbackService",["$filter",function(a){var b=function(b,c){if(0===c.length||!b)return"0%";var d=b.length;return a("number")(d/c.length*100,0)+"%"};return{getAverageRating:function(a){if(!a||0===a.length)return 0;var b=0,c=0;return _.each(a,function(a,d){0!==a.Rating&&(b+=a.Rating,c++)}),0===c?0:b/c},getRatingDistribute:function(a){if(!a)return 0;var c=_.filter(a,function(a){return a.Rating>0}),d=_.groupBy(c,function(a){return a.Rating});return{2:b(d[2],c),4:b(d[4],c),6:b(d[6],c),8:b(d[8],c),10:b(d[10],c)}}}}]),angular.module("webappApp").service("SkillService",["$http",function(a){return{getSkills:function(){return a.get("/api/skills")}}}]),angular.module("webappApp").service("UserService",["$http",function(a){return{getCurrentUser:function(){return a.get("/api/current-user")},getUserHistoryTrainingCourse:function(b){return a.get("/api/history-training-course/"+b)},getUser:function(b){return a.get("/api/user/"+b)},getExperts:function(){return a.get("/api/user/experts")}}}]),angular.module("webappApp").service("UserKpiService",["$http",function(a){return{getTrainingDays:function(a){return a?_.reduce(a,function(a,b){var c=new Date(b.EndDate),d=new Date(b.StartDate),e=(c-d)/864e5+1;return a+e},0):0}}}]),angular.module("webappApp").service("CourseAttachmentService",["$http",function(a){return{uploadAttachment:function(a,b){return $.ajax({type:"POST",url:"/api/course-attachment/"+a,contentType:!1,processData:!1,data:b})},downloadAttachment:function(b,c,d){a.get("/api/course-attachment/"+b,{responseType:"arraybuffer"}).success(function(a,b,d){var e="application/octet-stream";d=d();var f=d["content-disposition"].split(";")[1].split("=")[1],g=f;g.indexOf('"')>-1&&(g=f.substring(1,f.length-1));var h=d["content-type"]||e,i=navigator.msSaveBlob||navigator.webkitSaveBlob||navigator.mozSaveBlob||navigator.saveBlob;if(i){var j=new Blob([a],{type:h});i(j,g),console.log("SaveBlob Success")}else{var k=window.URL||window.webkitURL||window.mozURL||window.msURL;if(k){var l=document.createElement("a");if("download"in l){var j=new Blob([a],{type:h}),m=k.createObjectURL(j);l.setAttribute("href",m),l.setAttribute("download",g);var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),l.dispatchEvent(n)}else{var j=new Blob([a],{type:e}),m=k.createObjectURL(j);window.location=m}}else window.open(c+"CourseRegConfirm/getfile","_blank","")}}).error(function(a,b){d&&d()})}}}]),angular.module("webappApp").directive("starRating",function(){var a,b,c,d=function(a,b){for(var c="",d=0;b>d;d++)c+='<i class="fa '+a+'"></i>';return c},e={0:"Terrible",1:"Not good",2:"Normal",3:"Very good",4:"Excellent"},f=function(a){for(var d=0;a>=d;d++)$(b[d]).removeClass("fa-star-o").addClass("fa-star");for(var f=a+1;5>f;f++)$(b[f]).removeClass("fa-star").addClass("fa-star-o");c.html(e[a])},g=function(){for(var a=0;5>a;a++)$(b[a]).removeClass("fa-star").addClass("fa-star-o");c.html("Select the rating.")},h=function(a){b.bind({mouseenter:function(){var a=$(this).index();f(a)},mouseleave:function(){g()}}),b.on("click",function(c,d){var e=$(this).index();b.unbind(),a.$emit("clickRating",{rating:2*(e+1)})})},i=function(a,b){var c=parseInt(a/2),e=a%2>.5?1:0,f=5-c-e,g="true"===b?"enable-feedback-star":"",h='<span class="feedback-star '+g+'">';return h+=d("fa-star",c),h+=d("fa-star-half-o",e),h+=d("fa-star-o",f),h+="</span>"};return{restrict:"E",scope:{ratingScore:"=score"},link:function(d,e,f){var j=f.clickable||!1,k=d.ratingScore||0,l=f.parentclass||"",m=i(k,j,e);e.replaceWith(m),j&&(a=angular.element(".enable-feedback-star"),b=a.find("i"),a.append('<span class="star-short-comments" ng-bind="feedback.comments"></span>'),c=a.find(".star-short-comments"),c.html("Select the rating."),h(d)),d.$on("clearFeedbackScore",function(){g(),h(d)}),d.$watch("ratingScore",function(a,b){var c=i(a,j);if(l){var d=angular.element("."+l+" .feedback-star");d.replaceWith(c)}})}}}),angular.module("webappApp").directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}),angular.module("webappApp").filter("localDateFilter",["$filter",function(a){return function(a){if(!a)return"";var b=new Date(a+"Z");b.toLocaleString();return b}}]),angular.module("webappApp").filter("ginFilter",["$filter",function(a){var b=function(a){a=a.trim();var b=a.length;return 7===b?"0"+a:6===b?"00"+a:5===b?"000"+a:a};return function(a){return a?b(a):""}}]),angular.module("webappApp").filter("oncePerMonth",function(){return function(a){var b=_.uniq(a,!0,function(a){return a.StartDate.substr(2,5)});return b}});